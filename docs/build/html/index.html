

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Welcome to Pyeo’s documentation! &mdash; Pyeo  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="pyeo.array_utilities" href="array_utilities.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="#" class="icon icon-home"> Pyeo
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Welcome to Pyeo’s documentation!</a><ul>
<li class="toctree-l2"><a class="reference internal" href="array_utilities.html">pyeo.array_utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="classification.html">pyeo.classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="coordinate_manipulation.html">pyeo.coordinate_manipulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="queries_and_downloads.html">pyeo.queries_and_downloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="validation.html">pyeo.validaion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="#quick-start">Quick start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#use">Use</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#assumptions-and-design-decisions">Assumptions and design decisions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#rasters">Rasters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#masks">Masks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#timestamps">Timestamps</a></li>
<li class="toctree-l2"><a class="reference internal" href="#models">Models</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#module-pyeo.apps.change_detection.image_comparison">Applications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#image-comparison">image_comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rolling-composite-s2-change-detection">rolling_composite_s2_change_detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simple-s2-change-detection">simple_s2_change_detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#filter-by-class-map">filter_by_class_map</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="array_utilities.html">pyeo.array_utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="classification.html">pyeo.classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="coordinate_manipulation.html">pyeo.coordinate_manipulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="queries_and_downloads.html">pyeo.queries_and_downloads</a></li>
<li class="toctree-l1"><a class="reference internal" href="validation.html">pyeo.validaion</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">Pyeo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#">Docs</a> &raquo;</li>
        
      <li>Welcome to Pyeo’s documentation!</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="welcome-to-pyeo-s-documentation">
<h1>Welcome to Pyeo’s documentation!<a class="headerlink" href="#welcome-to-pyeo-s-documentation" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Welcome to Pyeo’s documentation!</a><ul>
<li class="toctree-l2"><a class="reference internal" href="array_utilities.html">pyeo.array_utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="classification.html">pyeo.classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="coordinate_manipulation.html">pyeo.coordinate_manipulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="queries_and_downloads.html">pyeo.queries_and_downloads</a><ul>
<li class="toctree-l3"><a class="reference internal" href="queries_and_downloads.html#safe-files">SAFE files</a></li>
<li class="toctree-l3"><a class="reference internal" href="queries_and_downloads.html#query-data-structure">Query data structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="queries_and_downloads.html#data-download-sources">Data download sources</a></li>
<li class="toctree-l3"><a class="reference internal" href="queries_and_downloads.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="validation.html">pyeo.validaion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="#quick-start">Quick start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#use">Use</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#assumptions-and-design-decisions">Assumptions and design decisions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#rasters">Rasters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#masks">Masks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#timestamps">Timestamps</a></li>
<li class="toctree-l2"><a class="reference internal" href="#models">Models</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#module-pyeo.apps.change_detection.image_comparison">Applications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#image-comparison">image_comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rolling-composite-s2-change-detection">rolling_composite_s2_change_detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simple-s2-change-detection">simple_s2_change_detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#filter-by-class-map">filter_by_class_map</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="array_utilities.html">pyeo.array_utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="classification.html">pyeo.classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="coordinate_manipulation.html">pyeo.coordinate_manipulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="queries_and_downloads.html">pyeo.queries_and_downloads</a><ul>
<li class="toctree-l2"><a class="reference internal" href="queries_and_downloads.html#safe-files">SAFE files</a></li>
<li class="toctree-l2"><a class="reference internal" href="queries_and_downloads.html#query-data-structure">Query data structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="queries_and_downloads.html#data-download-sources">Data download sources</a></li>
<li class="toctree-l2"><a class="reference internal" href="queries_and_downloads.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="validation.html">pyeo.validaion</a></li>
</ul>
</div>
</div>
<div class="section" id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<p>Python For Earth Observation is a collection of functions for downloading, manipulating, combining and classifying
geospatial raster and vector data. It is intended to require a minimum of dependencies - most functions only require
the basic GDAL/OGR/OSR stack and Numpy.</p>
</div>
<div class="section" id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<p>With Git and Miniconda or Anaconda installed, <code class="code docutils literal notranslate"><span class="pre">cd</span></code> to an install location then run the following lines</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/clcr/pyeo.git
<span class="nb">cd</span> pyeo
conda env create --file environment.yml --name pyeo_env
conda activate pyeo_env
python -m pip install . -vv
</pre></div>
</div>
<p>In a Python prompt, try  <code class="code docutils literal notranslate"><span class="pre">import</span> <span class="pre">pyeo</span></code> - you should see no errors.</p>
</div>
<div class="section" id="quick-start">
<h1>Quick start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h1>
<p>Before you start, you will need:</p>
<ul class="simple">
<li><p>A linux (or maybe mac, untested) machine</p></li>
<li><p>A raster of your window area</p></li>
<li><p>A shapefile of polygons over your training areas with a field containing class labels</p></li>
<li><p>A raster to classify. This can be the same as your original raster.</p>
<ul>
<li><p>All rasters and shapefiles should be in the same projection; ideally in the local projection of your satellite data.</p></li>
</ul>
</li>
<li><p>Git</p></li>
<li><p>Anaconda/Miniconda</p></li>
</ul>
<div class="section" id="use">
<h2>Use<a class="headerlink" href="#use" title="Permalink to this headline">¶</a></h2>
<p>To create a model</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda activate pyeo_env
<span class="nb">cd</span> <span class="o">(</span>whereever your data is<span class="o">)</span>
extract_signatures your_raster.tif your_shapefile.shp output.csv
<span class="c1"># You can now explore your signatures as a .csv file, and perform any interim processing</span>
create_model_from_signatures output.csv model.pkl
classify_image your_raster model.pkl output_image.tif
</pre></div>
</div>
</div>
</div>
<div class="section" id="assumptions-and-design-decisions">
<h1>Assumptions and design decisions<a class="headerlink" href="#assumptions-and-design-decisions" title="Permalink to this headline">¶</a></h1>
<div class="section" id="rasters">
<h2>Rasters<a class="headerlink" href="#rasters" title="Permalink to this headline">¶</a></h2>
<p>When working with raster data (geotiff, .jp2, ect) using Pyeo, the folllowing assumtions have been made:</p>
<ul class="simple">
<li><p>Any function that reads a raster can read from any gdal-readable format</p></li>
<li><p>All interim rasters are stored internally as a geotiff</p></li>
<li><p>All internal rasters have a .tif extension in the filename</p></li>
<li><p>Unless otherwise stated, <strong>all rasters are assumed to be in a projected coordinate system</strong> - i.e. in meters.
Functions may fail if passed a raster in lat-long projection</p></li>
</ul>
</div>
<div class="section" id="masks">
<h2>Masks<a class="headerlink" href="#masks" title="Permalink to this headline">¶</a></h2>
<p>Some Pyeo functions include options for applying masks.</p>
<ul class="simple">
<li><p>A raster may have an associated mask</p></li>
<li><dl class="simple">
<dt>A mask is a geotif with an identical name as the raster it’s masking with a .msk extension</dt><dd><ul>
<li><p>For example, the mask for my_sat_image.tif is my_sat_image.msk</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>A mask is</dt><dd><ul>
<li><p>a single band raster</p></li>
<li><p>of identical height, width and resolution of the related image</p></li>
<li><p>contains values 0 or 1</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>A mask is applied by multiplying it with each band of its raster</dt><dd><ul>
<li><p>So any pixel with a 0 in its mask will be removed, and a 1 will be kept</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="timestamps">
<h2>Timestamps<a class="headerlink" href="#timestamps" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><dl class="simple">
<dt>Pyeo uses the same timestamp convention as ESA: yyyymmddThhmmss</dt><dd><ul>
<li><p>For example, 1PM on 27th December 2020 would be 20201227T130000</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>All timestamps are in UTC</p></li>
</ul>
</div>
<div class="section" id="models">
<h2>Models<a class="headerlink" href="#models" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>All models are serialised and deserialised using joblib.dump or joblib.load</p></li>
</ul>
<p>A small test suite is located in pyeo/tests/pyeo_tests.py; this is designed for use with py.test.
Some example applications and demos are in pyeo/apps; for an illustration of the use of the library,
pyeo/apps/change_detection/simple_s2_change_detection.py is recommended.</p>
</div>
</div>
<div class="section" id="module-pyeo.apps.change_detection.image_comparison">
<span id="applications"></span><h1>Applications<a class="headerlink" href="#module-pyeo.apps.change_detection.image_comparison" title="Permalink to this headline">¶</a></h1>
<div class="section" id="image-comparison">
<h2>image_comparison<a class="headerlink" href="#image-comparison" title="Permalink to this headline">¶</a></h2>
<p>An application for applying a pickled scikit-learn model to two contiguous raster images.</p>
<p>Example call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$image_comparison image_1.tif image_2.tif model.pkl class_map.tif
</pre></div>
</div>
</div>
<span class="target" id="module-pyeo.apps.change_detection.rolling_composite_s2_change_detection"></span><div class="section" id="rolling-composite-s2-change-detection">
<h2>rolling_composite_s2_change_detection<a class="headerlink" href="#rolling-composite-s2-change-detection" title="Permalink to this headline">¶</a></h2>
<dl>
<dt>An app for providing continuous change detection. Runs the following algorithm</dt><dd><p>Step -1: Create initial composite with last date (stored in filename?)</p>
<p>Step 0: Load composite</p>
<p>Step 1: Download images from last date in composite until present last date</p>
<p>Step 2: Preprocess each image</p>
<p>Step 3: Generate cloud mask for each image</p>
</dd>
</dl>
<p>For each preprocessed image:</p>
<blockquote>
<div><p>Step 4: Build stack with composite</p>
<p>Step 5: Classify stack</p>
<p>Step 6: Update composite with last cloud-free pixel based on cloud mask</p>
<p>Step 7: Update last_date of composite</p>
</div></blockquote>
</div>
<span class="target" id="module-pyeo.apps.change_detection.simple_s2_change_detection"></span><div class="section" id="simple-s2-change-detection">
<h2>simple_s2_change_detection<a class="headerlink" href="#simple-s2-change-detection" title="Permalink to this headline">¶</a></h2>
<p>A change detection script that downloads, stacks and classifies a set of 10m sentinel 2 images.</p>
<p>When run, this script will download every S2 image in the aoi (defined by the geojson at aoi_path) between the two
dates that meets the specified cloud cover range. It will use the sen2cor distribution specified in the .ini file
to atmospherically correct the data to L2A, merge each set of 10m bands into a single geotiff, stack the images
into pairs based on the algorithm in create_new_stacks and classify those images using a scikit-learn model</p>
<p>To use this script, fill out the [sent_2], [forest_sentinel] and [sen2cor] sections of the configuration file
change_detection.ini, then run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python pyeo/apps/change_detection/simple_s2_change_detection.py --conf /path/to/change_detection.ini
</pre></div>
</div>
<p>Produces two directories of un-mosaiced imagery; one of classified images and one of class probabilites</p>
</div>
<span class="target" id="module-pyeo.apps.masking.filter_by_class_map"></span><div class="section" id="filter-by-class-map">
<h2>filter_by_class_map<a class="headerlink" href="#filter-by-class-map" title="Permalink to this headline">¶</a></h2>
<p>Filters every pixel in input_image that is not one of filter_classes.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ filter_by_class_map my_image.tif my_class_map.tif my_output_image.tif useful_class_1 useful_class_2
</pre></div>
</div>
<p>This will create an image, my_output_image.tif, that contains only the pixels from my_image.tif
that are labelled as useful_class_1 and useful_class_2 in my_class_map.tif</p>
</div>
<span class="target" id="module-pyeo.apps.model_creation.create_model_from_region"></span></div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="array_utilities.html" class="btn btn-neutral float-right" title="pyeo.array_utilities" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, John Roberts

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>